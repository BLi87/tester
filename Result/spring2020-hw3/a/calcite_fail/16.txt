WITH Danlikes(beer) AS (SELECT beer FROM likes WHERE drinker='Dan'),Danbars(bar,beer,price) AS (SELECT serves.bar,serves.beer,serves.price FROM serves, Danlikes WHERE serves.beer=Danlikes.beer GROUP BY serves.beer,serves.bar,serves.price ORDER BY price DESC), maxbeerprice(beer,max) AS (SELECT  beer, MAX(price) FROM Danbars GROUP BY  beer) SELECT maxbeerprice.beer,Danbars.bar FROM Danbars, maxbeerprice WHERE maxbeerprice.beer = Danbars.beer AND maxbeerprice.max = Danbars.price;