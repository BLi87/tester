(with maxes as (select drinker, MAX(times_a_week) from frequents group by drinker) select f.drinker as name, bar from frequents f JOIN maxes ON maxes.drinker=f.drinker and f.times_a_week=maxes.max) union (select name, bar from drinker LEFT OUTER JOIN frequents ON drinker.name=frequents.drinker where frequents.bar IS NULL)
