select final_chart.name as bar, SUM(income) as income from (select name, 0 as income from bar union (select chart.bar, SUM(chart.times_a_week*chart.price) as income from (select likes.drinker, likes.beer, frequents_likes.bar, frequents_likes.times_a_week, frequents_likes.price from likes inner join (select frequents.drinker, frequents.bar, frequents.times_a_week, serves.beer, serves.price from frequents inner join serves on frequents.bar = serves.bar) as frequents_likes on frequents_likes.drinker = likes.drinker and frequents_likes.beer = likes.beer) as chart group by chart.bar order by income DESC, bar ASC)) as final_chart group by final_chart.name order by income DESC, bar ASC;