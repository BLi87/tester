Select g.name, CASE WHEN sum(times_a_week*price) is null THEN 0 ELSE sum(times_a_week*price) END as amount from (select d.name, d.drinker, d.times_a_week, d.beer, serves.price from serves right join (select f.name, f.drinker, f.times_a_week, likes.beer from likes right join (select bar.name, frequents.drinker, frequents.times_a_week from bar full outer  join frequents on bar.name=frequents.bar) as f on f.drinker=likes.drinker) as d on serves.beer=d.beer and serves.bar=d.name) as g group by g.name order by amount desc, name;
