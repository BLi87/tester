WITH justorder AS (WITH allbut0 AS (WITH temp AS (WITH tmp AS (SELECT serves.bar, drinker, beer, times_a_week, price FROM serves, frequents WHERE serves.bar=frequents.bar) SELECT tmp.bar, tmp.drinker, tmp.beer, tmp.price, tmp.times_a_week  FROM tmp, likes WHERE likes.drinker=tmp.drinker AND likes.beer=tmp.beer) SELECT bar, SUM(price*times_a_week) AS amount FROM temp GROUP BY bar ORDER BY amount DESC)SELECT * FROM allbut0 UNION (WITH only0 AS ((SELECT name FROM bar) EXCEPT (SELECT bar FROM allbut0)) SELECT name, 0 AS amount  FROM only0)) SELECT * FROM justorder ORDER BY amount DESC, bar;

