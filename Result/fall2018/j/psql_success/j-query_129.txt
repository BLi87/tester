(WITH close2 AS ((SELECT b1.name AS barname1, b2.name AS barname2 FROM bar AS b1, bar AS b2) EXCEPT (WITH temp2 AS ((SELECT DISTINCT bar, name, beer FROM serves, bar WHERE bar!=name)EXCEPT (SELECT DISTINCT s1.bar AS bar1, s2.bar AS bar2, s2.beer AS brew FROM serves AS s1, serves AS s2 WHERE s1.beer=s2.beer AND s1.bar!=s2.bar)) SELECT DISTINCT bar AS barname1, name AS barname2 FROM temp2)) SELECT barname1, barname2 FROM close2) EXCEPT (WITH close1 AS ((SELECT b1.name AS barname1, b2.name AS barname2 FROM bar AS b1, bar AS b2) EXCEPT (WITH temp1 AS ((SELECT DISTINCT bar, name, beer FROM serves, bar WHERE bar!=name)EXCEPT (SELECT DISTINCT s1.bar AS bar1, s2.bar AS bar2, s2.beer AS brew FROM serves AS s1, serves AS s2 WHERE s1.beer=s2.beer AND s1.bar!=s2.bar)) SELECT DISTINCT bar AS barname1, name AS barname2 FROM temp1)) SELECT barname2, barname1 FROM close1); 
